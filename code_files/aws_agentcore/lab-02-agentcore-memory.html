<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lab 2: Personalize our agent by adding memory ‚Äì Aarushi Nema</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-710753787207b25228f8cf56d22a49c7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Aarushi Nema</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html"> 
<span class="menu-text">Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../design_portfolio.html"> 
<span class="menu-text">Design Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../art.html"> 
<span class="menu-text">Art</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/aarushi-nema"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/aarushi-nema-64a006185/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Personalize our agent by adding memory</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Author:</strong> Aarushi Nema<br>
<strong>Date:</strong> 2025-09-17<br>
<strong>Tags:</strong> Customer Support Agent, Amazon BedRock AgentCore, AWS, Machine Learning, Agentic AI, Memory, Personalization, Short-Term Memory, Long-Term Memory, Production, Cloud Computing, Strands Agents, Anthropic Claude, Bedrock<br>
<strong>Categories:</strong> Machine Learning, Agentic AI, AWS, Workshop<br>
<strong>Abstract:</strong> This lab focuses on enhancing the customer support agent with memory capabilities using Amazon Bedrock AgentCore Memory. Learn to implement both short-term and long-term memory for personalized customer experiences.</p>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>In Lab 1, you built a Customer Support Agent that worked well for a single user in a local session. However, real-world customer support needs to scale beyond a single user running in a local environment.</p>
<p>When we run an <strong>Agent in Production</strong>, we‚Äôll need: - <strong>Multi-User Support</strong>: Handle thousands of customers simultaneously - <strong>Persistent Storage</strong>: Save conversations beyond session lifecycle - <strong>Long-Term Learning</strong>: Extract customer preferences and behavioral patterns - <strong>Cross-Session Continuity</strong>: Remember customers across different interactions</p>
<p><strong>Workshop Progress:</strong> - <strong>Lab 1 (Done)</strong>: Create Agent Prototype - Build a functional customer support agent - <strong>Lab 2 (Current)</strong>: Enhance with Memory - Add conversation context and personalization - <strong>Lab 3</strong>: Scale with Gateway &amp; Identity - Share tools across agents securely - <strong>Lab 4</strong>: Deploy to Production - Use AgentCore Runtime with observability - <strong>Lab 5</strong>: Build User Interface - Create a customer-facing application</p>
<p>In this lab, you‚Äôll add the missing persistence and learning layer that transforms your Goldfish-Agent (forgets the conversation in seconds) into an smart personalized Assistant.</p>
<p>Memory is a critical component of intelligence. While Large Language Models (LLMs) have impressive capabilities, they lack persistent memory across conversations. <a href="https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/memory-getting-started.html">Amazon Bedrock AgentCore Memory</a> addresses this limitation by providing a managed service that enables AI agents to maintain context over time, remember important facts, and deliver consistent, personalized experiences.</p>
<p>AgentCore Memory operates on two levels: - <strong>Short-Term Memory</strong>: Immediate conversation context and session-based information that provides continuity within a single interaction or closely related sessions. - <strong>Long-Term Memory</strong>: Persistent information extracted and stored across multiple conversations, including facts, preferences, and summaries that enable personalized experiences over time.</p>
</section>
<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<ul>
<li>Understand the importance of memory in AI agents</li>
<li>Implement AgentCore Memory resources with multiple strategies</li>
<li>Configure short-term and long-term memory for customer support</li>
<li>Learn about USER_PREFERENCE and SEMANTIC memory strategies</li>
<li>Transform a stateless agent into a personalized assistant</li>
</ul>
<section id="architecture-for-lab-2" class="level3">
<h3 class="anchored" data-anchor-id="architecture-for-lab-2">Architecture for Lab 2</h3>
<div style="text-align:left">
<pre><code>&lt;img src="images/architecture_lab2_memory.png" width="75%"/&gt;</code></pre>
</div>
<p><em>Multi-user agent with persistent short term and long term memory capabilities. </em></p>
</section>
<section id="prerequisites" class="level3">
<h3 class="anchored" data-anchor-id="prerequisites">Prerequisites</h3>
<ul>
<li><strong>AWS Account</strong> with appropriate permissions</li>
<li><strong>Python 3.10+</strong> installed locally</li>
<li><strong>AWS CLI configured</strong> with credentials</li>
<li><strong>Anthropic Claude 3.7</strong> enabled on <a href="https://docs.aws.amazon.com/bedrock/latest/userguide/model-access.html">Amazon Bedrock</a></li>
<li><strong>Strands Agents</strong> and other libraries installed in the next cells</li>
<li>These resources are created for you within an AWS workshop account
<ul>
<li>AWS Lambda function</li>
<li>AWS Lambda Execution IAM Role</li>
<li>AgentCore Gateway IAM Role</li>
<li>DynamoDB tables used by the AWS Lambda function.</li>
<li>Cognito User Pool and User Pool Client #### Not using an AWS workshop account?</li>
</ul></li>
</ul>
<p><strong>Note:</strong> If you are running this as a self-paced lab you must run create the cloudformation resources as shown in the workshop self-paced steps. If you have not, then uncomment and run the below code segment</p>
<div id="cell-2" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:03:05.952445Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:03:05.952177Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:03:05.955171Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:03:05.954607Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:03:05.952422Z&quot;}}" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!bash scripts/prereq.sh</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-1-import-libraries" class="level3">
<h3 class="anchored" data-anchor-id="step-1-import-libraries">Step 1: Import Libraries</h3>
<p>Let‚Äôs import the libraries for AgentCore Memory. For it, we will use the <a href="https://github.com/aws/bedrock-agentcore-sdk-python">Amazon Bedrock AgentCore Python SDK</a>, a lightweight wrapper that helps you working with AgentCore capabilities.</p>
<div id="cell-4" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:03:11.673382Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:03:11.673131Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:03:12.280312Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:03:12.279725Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:03:11.673362Z&quot;}}" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Import agentCore Memory</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bedrock_agentcore.memory <span class="im">import</span> MemoryClient</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bedrock_agentcore.memory.constants <span class="im">import</span> StrategyType</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> strands.hooks <span class="im">import</span> AfterInvocationEvent, HookProvider, HookRegistry, MessageAddedEvent</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> boto3</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> boto3.session <span class="im">import</span> Session</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>boto_session <span class="op">=</span> Session()</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>REGION <span class="op">=</span> boto_session.region_name</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>logger <span class="op">=</span> logging.getLogger(<span class="va">__name__</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lab_helpers.utils <span class="im">import</span> get_ssm_parameter, put_ssm_parameter</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-2-create-bedrock-agentcore-memory-resources" class="level3">
<h3 class="anchored" data-anchor-id="step-2-create-bedrock-agentcore-memory-resources">Step 2: Create Bedrock AgentCore Memory resources</h3>
<p>Amazon Bedrock AgentCore Memory is a fully managed service that provides persistent memory capabilities for AI agents.</p>
<section id="agentcore-memory-concepts" class="level4">
<h4 class="anchored" data-anchor-id="agentcore-memory-concepts">AgentCore Memory Concepts:</h4>
<ol type="1">
<li><strong>Short-Term Memory (STM)</strong>: Immediately stores conversation context within the session</li>
<li><strong>Long-Term Memory (LTM)</strong>: Asynchronously processes STM to extract meaningful patterns, preferences and facts</li>
<li><strong>Memory Strategies</strong>: Different approaches for extracting and organizing information:
<ul>
<li><strong>USER_PREFERENCE</strong>: Learns customer preferences, behaviors, and patterns</li>
<li><strong>SEMANTIC</strong>: Stores factual information using vector embeddings for similarity search</li>
</ul></li>
<li><strong>Namespaces</strong>: Logical grouping of memories by customer and context type. We‚Äôll create these two namespaces:</li>
</ol>
<ul>
<li><code>support/customer/{actorId}/preferences</code>: Customer preferences and behavioral patterns</li>
<li><code>support/customer/{actorId}/semantic</code>: Factual information and conversation history</li>
</ul>
<p>This structure enables multi-tenant memory where each customer‚Äôs information is isolated and easily retrievable.</p>
</section>
<section id="memory-creation-process" class="level4">
<h4 class="anchored" data-anchor-id="memory-creation-process">Memory Creation Process:</h4>
<p>Creating memory resources involves provisioning the underlying infrastructure (vector databases, processing pipelines, etc.). This typically takes 2-3 minutes as AWS sets up the managed services behind the scenes.</p>
<div id="cell-6" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:03:34.213676Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:03:34.213287Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:03:34.239777Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:03:34.239136Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:03:34.213651Z&quot;}}" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>memory_client <span class="op">=</span> MemoryClient(region_name<span class="op">=</span>REGION)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>memory_name <span class="op">=</span> <span class="st">"CustomerSupportMemory"</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_or_get_memory_resource():</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        memory_id <span class="op">=</span> get_ssm_parameter(<span class="st">"/app/customersupport/agentcore/memory_id"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        memory_client.gmcp_client.get_memory(memoryId<span class="op">=</span>memory_id)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> memory_id</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            strategies <span class="op">=</span> [</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                    StrategyType.USER_PREFERENCE.value: {</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"name"</span>: <span class="st">"CustomerPreferences"</span>,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"description"</span>: <span class="st">"Captures customer preferences and behavior"</span>,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"namespaces"</span>: [<span class="st">"support/customer/</span><span class="sc">{actorId}</span><span class="st">/preferences"</span>],</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                {</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                    StrategyType.SEMANTIC.value: {</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"name"</span>: <span class="st">"CustomerSupportSemantic"</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"description"</span>: <span class="st">"Stores facts from conversations"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"namespaces"</span>: [<span class="st">"support/customer/</span><span class="sc">{actorId}</span><span class="st">/semantic"</span>],</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                },</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            ]</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"Creating AgentCore Memory resources. This will take 2-3 minutes..."</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"While we wait, let's understand what's happening behind the scenes:"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"‚Ä¢ Setting up managed vector databases for semantic search"</span>)</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"‚Ä¢ Configuring memory extraction pipelines"</span>)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"‚Ä¢ Provisioning secure, multi-tenant storage"</span>)</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">"‚Ä¢ Establishing namespace isolation for customer data"</span>)</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># *** AGENTCORE MEMORY USAGE *** - Create memory resource with semantic strategy</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>            response <span class="op">=</span> memory_client.create_memory_and_wait(</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>                name<span class="op">=</span>memory_name,</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>                description<span class="op">=</span><span class="st">"Customer support agent memory"</span>,</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>                strategies<span class="op">=</span>strategies,</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>                event_expiry_days<span class="op">=</span><span class="dv">90</span>,          <span class="co"># Memories expire after 90 days</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>            memory_id <span class="op">=</span> response[<span class="st">"id"</span>]</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                put_ssm_parameter(<span class="st">"/app/customersupport/agentcore/memory_id"</span>, memory_id)</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> memory_id</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Failed to create memory resource: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="cell-7" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:03:37.332502Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:03:37.332226Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:06:31.477279Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:06:31.476606Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:03:37.332481Z&quot;}}" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>memory_id <span class="op">=</span> create_or_get_memory_resource()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> memory_id:</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"‚úÖ AgentCore Memory created successfully!"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Memory ID: </span><span class="sc">{</span>memory_id<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Memory resource not created. Try Again !"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Creating AgentCore Memory resources. This will take 2-3 minutes...
While we wait, let's understand what's happening behind the scenes:
‚Ä¢ Setting up managed vector databases for semantic search
‚Ä¢ Configuring memory extraction pipelines
‚Ä¢ Provisioning secure, multi-tenant storage
‚Ä¢ Establishing namespace isolation for customer data
‚úÖ AgentCore Memory created successfully!
Memory ID: CustomerSupportMemory-cGl9C845Vd</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="step-3-seed-previous-customer-interactions" class="level2">
<h2 class="anchored" data-anchor-id="step-3-seed-previous-customer-interactions">Step 3: Seed previous customer interactions</h2>
<p><strong>Why are we seeding memory?</strong></p>
<p>In production, agents accumulate memory naturally through customer interactions. However, for this lab, we‚Äôre seeding historical conversations to demonstrate how Long-Term Memory (LTM) works without waiting for real conversations.</p>
<p><strong>How memory processing works:</strong> 1. <code>create_event</code> stores interactions in <strong>Short-Term Memory</strong> (STM) instantly 2. STM is asynchronously processed by <strong>Long-Term Memory</strong> strategies 3. LTM extracts patterns, preferences, and facts for future retrieval</p>
<p>Let‚Äôs seed some customer history to see this in action:</p>
<div id="cell-9" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:07:03.533585Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:07:03.533318Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:07:03.823746Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:07:03.823169Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:07:03.533565Z&quot;}}" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List existing memory resources</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> memory <span class="kw">in</span> memory_client.list_memories():</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Memory Arn: </span><span class="sc">{</span>memory<span class="sc">.</span>get(<span class="st">'arn'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Memory ID: </span><span class="sc">{</span>memory<span class="sc">.</span>get(<span class="st">'id'</span>)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"--------------------------------------------------------------------"</span>)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Seed with previous customer interactions</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>CUSTOMER_ID <span class="op">=</span> <span class="st">"customer_001"</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>previous_interactions <span class="op">=</span> [</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I'm having issues with my MacBook Pro overheating during video editing."</span>,<span class="st">"USER"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I can help with that thermal issue. For video editing workloads, let's check your Activity Monitor and adjust performance settings. Your MacBook Pro order #MB-78432 is still under warranty."</span>, <span class="st">"ASSISTANT"</span>),</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"What's the return policy on gaming headphones? I need low latency for competitive FPS games"</span>, <span class="st">"USER"</span>),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"For gaming headphones, you have 30 days to return. Since you're into competitive FPS, I'd recommend checking the audio latency specs - most gaming models have &lt;40ms latency."</span>, <span class="st">"ASSISTANT"</span>),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"I need a laptop under $1200 for programming. Prefer 16GB RAM minimum and good Linux compatibility. I like ThinkPad models."</span>, <span class="st">"USER"</span>),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    (<span class="st">"Perfect! For development work, I'd suggest looking at our ThinkPad E series or Dell XPS models. Both have excellent Linux support and 16GB RAM options within your budget."</span>, <span class="st">"ASSISTANT"</span>),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Save previous interactions</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> memory_id:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        memory_client.create_event(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            memory_id<span class="op">=</span>memory_id,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            actor_id<span class="op">=</span>CUSTOMER_ID,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            session_id<span class="op">=</span><span class="st">"previous_session"</span>,</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>            messages<span class="op">=</span>previous_interactions</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚úÖ Seeded customer history successfully"</span>)</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"üìù Interactions saved to Short-Term Memory"</span>)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚è≥ Long-Term Memory processing will begin automatically..."</span>)</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚ö†Ô∏è Error seeding history: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Memory Arn: arn:aws:bedrock-agentcore:us-west-2:900569417635:memory/CustomerSupportMemory-cGl9C845Vd
Memory ID: CustomerSupportMemory-cGl9C845Vd
--------------------------------------------------------------------
‚úÖ Seeded customer history successfully
üìù Interactions saved to Short-Term Memory
‚è≥ Long-Term Memory processing will begin automatically...</code></pre>
</div>
</div>
<section id="understanding-memory-processing" class="level3">
<h3 class="anchored" data-anchor-id="understanding-memory-processing">Understanding Memory Processing</h3>
<p>After creating events with <code>create_event</code>, AgentCore Memory processes the data in two stages:</p>
<ol type="1">
<li><strong>Immediate</strong>: Messages stored in Short-Term Memory (STM)</li>
<li><strong>Asynchronous</strong>: STM processed into Long-Term Memory (LTM) strategies</li>
</ol>
<p>LTM processing typically takes 20-30 seconds as the system: - Analyzes conversation patterns - Extracts customer preferences and behaviors - Creates semantic embeddings for factual information - Organizes memories by namespace for efficient retrieval</p>
<p>Let‚Äôs check if our Long-Term Memory processing is complete by retrieving customer preferences:</p>
<div id="cell-11" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:07:12.203607Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:07:12.203342Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:07:53.235028Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:07:53.234516Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:07:12.203587Z&quot;}}" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Wait for Long-Term Memory processing to complete</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üîç Checking for processed Long-Term Memories..."</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>retries <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>max_retries <span class="op">=</span> <span class="dv">6</span>  <span class="co"># 1 minute wait</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> retries <span class="op">&lt;</span> max_retries:</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    memories <span class="op">=</span> memory_client.retrieve_memories(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        memory_id<span class="op">=</span>memory_id,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        namespace<span class="op">=</span><span class="ss">f"support/customer/</span><span class="sc">{</span>CUSTOMER_ID<span class="sc">}</span><span class="ss">/preferences"</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        query<span class="op">=</span><span class="st">"can you summarize the support issue"</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> memories:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚úÖ Found </span><span class="sc">{</span><span class="bu">len</span>(memories)<span class="sc">}</span><span class="ss"> preference memories after </span><span class="sc">{</span>retries <span class="op">*</span> <span class="dv">10</span><span class="sc">}</span><span class="ss"> seconds!"</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    retries <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> retries <span class="op">&lt;</span> max_retries:</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"‚è≥ Still processing... waiting 10 more seconds (attempt </span><span class="sc">{</span>retries<span class="sc">}</span><span class="ss">/</span><span class="sc">{</span>max_retries<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="dv">10</span>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"‚ö†Ô∏è Memory processing is taking longer than expected. This can happen with overloading.."</span>)</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üéØ AgentCore Memory automatically extracted these customer preferences from our seeded conversations:"</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, memory <span class="kw">in</span> <span class="bu">enumerate</span>(memories, <span class="dv">1</span>):</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(memory, <span class="bu">dict</span>):</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> memory.get(<span class="st">'content'</span>, {})</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">dict</span>):</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> content.get(<span class="st">'text'</span>, <span class="st">''</span>)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>üîç Checking for processed Long-Term Memories...
‚è≥ Still processing... waiting 10 more seconds (attempt 1/6)
‚è≥ Still processing... waiting 10 more seconds (attempt 2/6)
‚è≥ Still processing... waiting 10 more seconds (attempt 3/6)
‚è≥ Still processing... waiting 10 more seconds (attempt 4/6)
‚úÖ Found 3 preference memories after 40 seconds!
üéØ AgentCore Memory automatically extracted these customer preferences from our seeded conversations:
================================================================================
  1. {"context":"User reported technical issue with MacBook Pro during video editing","preference":"Uses MacBook Pro for video editing, experiencing performance/thermal challenges","categories":["technology","computing","video editing","hardware"]}
  2. {"context":"User inquired about gaming headphones with specific performance requirement","preference":"Needs low latency gaming headphones for competitive FPS games","categories":["gaming","audio equipment","technology"]}
  3. {"context":"User explicitly mentioned requirements for laptop purchase for programming","preference":"Wants laptop under $1200, with 16GB RAM minimum, good Linux compatibility, preferring ThinkPad models","categories":["technology","computing","laptops","programming"]}</code></pre>
</div>
</div>
</section>
<section id="exploring-semantic-memory" class="level3">
<h3 class="anchored" data-anchor-id="exploring-semantic-memory">Exploring Semantic Memory</h3>
<p>Semantic memory stores factual information from conversations using vector embeddings. This enables similarity-based retrieval of relevant facts and context.</p>
<div id="cell-13" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:08:07.133651Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:08:07.133398Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:08:07.295285Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:08:07.294705Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:08:07.133632Z&quot;}}" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Retrieve semantic memories (factual information)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    semantic_memories <span class="op">=</span> memory_client.retrieve_memories(</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        memory_id<span class="op">=</span>memory_id,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        namespace<span class="op">=</span><span class="ss">f"support/customer/</span><span class="sc">{</span>CUSTOMER_ID<span class="sc">}</span><span class="ss">/semantic"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        query<span class="op">=</span><span class="st">"information on the technical support issue"</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"üß† AgentCore Memory identified these factual details from conversations:"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">80</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> memories:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    time.sleep(<span class="dv">10</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, memory <span class="kw">in</span> <span class="bu">enumerate</span>(semantic_memories, <span class="dv">1</span>):</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">isinstance</span>(memory, <span class="bu">dict</span>):</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> memory.get(<span class="st">'content'</span>, {})</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">dict</span>):</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            text <span class="op">=</span> content.get(<span class="st">'text'</span>, <span class="st">''</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"  </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">. </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>üß† AgentCore Memory identified these factual details from conversations:
================================================================================
  1. The user is interested in gaming headphones with low latency for competitive FPS games.
  2. The user is looking for a laptop under $1200 for programming, with a preference for 16GB RAM and good Linux compatibility.
  3. The user is experiencing overheating issues with their MacBook Pro during video editing.</code></pre>
</div>
</div>
</section>
</section>
<section id="step-3-implement-strands-hooks-to-save-and-retrieve-agent-interactions" class="level2">
<h2 class="anchored" data-anchor-id="step-3-implement-strands-hooks-to-save-and-retrieve-agent-interactions">Step 3: Implement Strands Hooks to save and retrieve agent interactions</h2>
<p>Now we‚Äôll integrate AgentCore Memory with our agent using Strands‚Äô hook system. This creates an automatic memory layer that works seamlessly with any agent conversation.</p>
<ul>
<li><strong>MessageAddedEvent</strong>: Triggered when messages are added to the conversation, allowing us to retrieve and inject customer context</li>
<li><strong>AfterInvocationEvent</strong>: Fired after agent responses, enabling automatic storage of interactions to memory</li>
</ul>
<p>The hook system ensures memory operations happen automatically without manual intervention, creating a seamless experience where customer context is preserved across conversations.</p>
<p>To create the hooks we will extend the <code>HookProvider</code> class:</p>
<div id="cell-15" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:08:16.621660Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:08:16.621407Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:08:16.631000Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:08:16.630398Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:08:16.621640Z&quot;}}" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> CustomerSupportMemoryHooks(HookProvider):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Memory hooks for customer support agent"""</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>, memory_id: <span class="bu">str</span>, client: MemoryClient, actor_id: <span class="bu">str</span>, session_id: <span class="bu">str</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.memory_id <span class="op">=</span> memory_id</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.client <span class="op">=</span> client</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.actor_id <span class="op">=</span> actor_id</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.session_id <span class="op">=</span> session_id</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.namespaces <span class="op">=</span> {</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            i[<span class="st">"type"</span>]: i[<span class="st">"namespaces"</span>][<span class="dv">0</span>]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="va">self</span>.client.get_memory_strategies(<span class="va">self</span>.memory_id)</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> retrieve_customer_context(<span class="va">self</span>, event: MessageAddedEvent):</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Retrieve customer context before processing support query"""</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        messages <span class="op">=</span> event.agent.messages</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>            messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"role"</span>] <span class="op">==</span> <span class="st">"user"</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">and</span> <span class="st">"toolResult"</span> <span class="kw">not</span> <span class="kw">in</span> messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"content"</span>][<span class="dv">0</span>]</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        ):</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            user_query <span class="op">=</span> messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                all_context <span class="op">=</span> []</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> context_type, namespace <span class="kw">in</span> <span class="va">self</span>.namespaces.items():</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># *** AGENTCORE MEMORY USAGE *** - Retrieve customer context from each namespace</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                    memories <span class="op">=</span> <span class="va">self</span>.client.retrieve_memories(</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                        memory_id<span class="op">=</span><span class="va">self</span>.memory_id,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                        namespace<span class="op">=</span>namespace.<span class="bu">format</span>(actorId<span class="op">=</span><span class="va">self</span>.actor_id),</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                        query<span class="op">=</span>user_query,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                        top_k<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># Post-processing: Format memories into context strings</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">for</span> memory <span class="kw">in</span> memories:</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> <span class="bu">isinstance</span>(memory, <span class="bu">dict</span>):</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                            content <span class="op">=</span> memory.get(<span class="st">"content"</span>, {})</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span> <span class="bu">isinstance</span>(content, <span class="bu">dict</span>):</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                                text <span class="op">=</span> content.get(<span class="st">"text"</span>, <span class="st">""</span>).strip()</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                                <span class="cf">if</span> text:</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                                    all_context.append(</span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                                        <span class="ss">f"[</span><span class="sc">{</span>context_type<span class="sc">.</span>upper()<span class="sc">}</span><span class="ss">] </span><span class="sc">{</span>text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Inject customer context into the query</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> all_context:</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                    context_text <span class="op">=</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(all_context)</span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                    original_text <span class="op">=</span> messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                    messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"content"</span>][<span class="dv">0</span>][</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"text"</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                    ] <span class="op">=</span> <span class="ss">f"Customer Context:</span><span class="ch">\n</span><span class="sc">{</span>context_text<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>original_text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>                    logger.info(<span class="ss">f"Retrieved </span><span class="sc">{</span><span class="bu">len</span>(all_context)<span class="sc">}</span><span class="ss"> customer context items"</span>)</span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                logger.error(<span class="ss">f"Failed to retrieve customer context: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> save_support_interaction(<span class="va">self</span>, event: AfterInvocationEvent):</span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Save customer support interaction after agent response"""</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>            messages <span class="op">=</span> event.agent.messages</span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">len</span>(messages) <span class="op">&gt;=</span> <span class="dv">2</span> <span class="kw">and</span> messages[<span class="op">-</span><span class="dv">1</span>][<span class="st">"role"</span>] <span class="op">==</span> <span class="st">"assistant"</span>:</span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Get last customer query and agent response</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>                customer_query <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>                agent_response <span class="op">=</span> <span class="va">None</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> msg <span class="kw">in</span> <span class="bu">reversed</span>(messages):</span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> msg[<span class="st">"role"</span>] <span class="op">==</span> <span class="st">"assistant"</span> <span class="kw">and</span> <span class="kw">not</span> agent_response:</span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>                        agent_response <span class="op">=</span> msg[<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">elif</span> (</span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>                        msg[<span class="st">"role"</span>] <span class="op">==</span> <span class="st">"user"</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">and</span> <span class="kw">not</span> customer_query</span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">and</span> <span class="st">"toolResult"</span> <span class="kw">not</span> <span class="kw">in</span> msg[<span class="st">"content"</span>][<span class="dv">0</span>]</span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>                    ):</span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>                        customer_query <span class="op">=</span> msg[<span class="st">"content"</span>][<span class="dv">0</span>][<span class="st">"text"</span>]</span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> customer_query <span class="kw">and</span> agent_response:</span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>                    <span class="co"># *** AGENTCORE MEMORY USAGE *** - Save the support interaction</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>                    <span class="va">self</span>.client.create_event(</span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>                        memory_id<span class="op">=</span><span class="va">self</span>.memory_id,</span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>                        actor_id<span class="op">=</span><span class="va">self</span>.actor_id,</span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>                        session_id<span class="op">=</span><span class="va">self</span>.session_id,</span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>                        messages<span class="op">=</span>[</span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>                            (customer_query, <span class="st">"USER"</span>),</span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>                            (agent_response, <span class="st">"ASSISTANT"</span>),</span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>                        ],</span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>                    )</span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>                    logger.info(<span class="st">"Saved support interaction to memory"</span>)</span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"Failed to save support interaction: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> register_hooks(<span class="va">self</span>, registry: HookRegistry) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""Register customer support memory hooks"""</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        registry.add_callback(MessageAddedEvent, <span class="va">self</span>.retrieve_customer_context)</span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>        registry.add_callback(AfterInvocationEvent, <span class="va">self</span>.save_support_interaction)</span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="st">"Customer support memory hooks registered"</span>)</span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-4-create-a-customer-support-agent-with-memory" class="level2">
<h2 class="anchored" data-anchor-id="step-4-create-a-customer-support-agent-with-memory">Step 4: Create a Customer Support Agent with memory</h2>
<p>Next, we will implement the Customer Support Agent just as we did in Lab 1, but this time we instantiate the class <code>CustomerSupportMemoryHooks</code> and we pass the memory hook to the agent contructor.</p>
<div id="cell-17" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:08:30.461369Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:08:30.461111Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:08:30.730381Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:08:30.729890Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:08:30.461350Z&quot;}}" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> uuid</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> strands <span class="im">import</span> Agent</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> strands.models <span class="im">import</span> BedrockModel</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> lab_helpers.lab1_strands_agent <span class="im">import</span> (</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    SYSTEM_PROMPT,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    get_return_policy, web_search,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    get_product_info, get_technical_support, MODEL_ID</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>SESSION_ID <span class="op">=</span> <span class="bu">str</span>(uuid.uuid4())</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>memory_hooks <span class="op">=</span> CustomerSupportMemoryHooks(memory_id, memory_client, CUSTOMER_ID, SESSION_ID)</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the Bedrock model (Anthropic Claude 3.7 Sonnet)</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> BedrockModel(</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    model_id<span class="op">=</span>MODEL_ID,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    region_name<span class="op">=</span>REGION</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the customer support agent with all 5 tools</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>agent <span class="op">=</span> Agent(</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    model<span class="op">=</span>model,</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    hooks<span class="op">=</span>[memory_hooks], <span class="co"># Pass Memory Hooks</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    tools<span class="op">=</span>[</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>        get_product_info,      <span class="co"># Tool 1: Simple product information lookup</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        get_return_policy,      <span class="co"># Tool 2: Simple return policy lookup</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        web_search,</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        get_technical_support</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    system_prompt<span class="op">=</span>SYSTEM_PROMPT</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="step-5-test-personalized-agent" class="level2">
<h2 class="anchored" data-anchor-id="step-5-test-personalized-agent">Step 5: Test Personalized Agent</h2>
<p>Let‚Äôs test our memory-enhanced agent! Watch how it uses the customer‚Äôs historical preferences to provide personalized recommendations.</p>
<p>The agent will automatically: 1. Retrieve relevant customer context from memory 2. Use that context to personalize the response 3. Save this new interaction for future use</p>
<div id="cell-19" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:09:41.042624Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:09:41.042241Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:09:59.072794Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:09:59.072247Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:09:41.042601Z&quot;}}" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> display, Markdown</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"üéß Testing headphone recommendation with customer memory...</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>response1 <span class="op">=</span> agent(<span class="st">"Which headphones would you recommend?"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>üéß Testing headphone recommendation with customer memory...


I'd be happy to help you find some gaming headphones with low latency, perfect for competitive FPS games where timing is critical. Let me get some specific information about gaming headphones for you.
Tool #1: get_product_info
Based on your need for low-latency gaming headphones for competitive FPS games, let me search for some specific recommendations that would work well for your requirements:
Tool #2: web_search
Based on the information I've gathered, here are my recommendations for gaming headphones that would be ideal for competitive FPS games where low latency is crucial:

### Top Recommendations for Low Latency Gaming Headphones:

1. **SteelSeries Arctis Nova Pro** - Considered a top choice for competitive gaming with excellent multi-device connectivity. The wireless version offers very low latency that's ideal for FPS games.

2. **Turtle Beach Stealth 700 Gen 2** - Specifically mentioned as a next-generation competitive gaming headset with improved audio performance for better game performance.

3. **Headphones with aptX Low Latency Support** - Look for headphones supporting this codec, as it can reduce latency to under 40ms, which experts consider ideal for competitive gaming.

### What to Look For:
- **Latency under 40ms** - For competitive FPS games, this is considered the benchmark for lag-free audio
- **Good positional audio** - Critical for accurately locating enemies in FPS games
- **Comfort** - Important for long gaming sessions
- **Quality microphone** - For clear communication with teammates

### Connection Type Consideration:
- **Wired options** generally offer the lowest latency and are most reliable for competitive play
- **Wireless options** with specialized gaming-focused transmission technology can also perform well

Would you like more specific information about any of these models? Or would you prefer I search for options in a particular price range? I can also provide information about return policies if you'd like to try a pair before fully committing to them.</code></pre>
</div>
</div>
<div id="cell-20" class="cell" data-quarto-private-1="{&quot;key&quot;:&quot;execution&quot;,&quot;value&quot;:{&quot;iopub.execute_input&quot;:&quot;2025-09-17T12:10:12.062589Z&quot;,&quot;iopub.status.busy&quot;:&quot;2025-09-17T12:10:12.062328Z&quot;,&quot;iopub.status.idle&quot;:&quot;2025-09-17T12:10:17.914933Z&quot;,&quot;shell.execute_reply&quot;:&quot;2025-09-17T12:10:17.914359Z&quot;,&quot;shell.execute_reply.started&quot;:&quot;2025-09-17T12:10:12.062570Z&quot;}}" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">üíª Testing laptop preference recall...</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>response2 <span class="op">=</span> agent(<span class="st">"What is my preferred laptop brand and requirements?"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
üíª Testing laptop preference recall...


Based on your previous interactions, I can see your preferred laptop specifications quite clearly.

Your preferred laptop requirements are:
- Brand preference: ThinkPad models
- Budget: Under $1200
- RAM: Minimum of 16GB
- Operating system compatibility: Good Linux compatibility
- Purpose: Programming

ThinkPad is definitely your preferred laptop brand, and you're looking for a model that meets these specific requirements for programming work. ThinkPads are known for their excellent Linux compatibility, which aligns perfectly with your preferences.

Is there anything specific about ThinkPad models you'd like to know more about, or would you like me to provide some recommendations for ThinkPad models that meet your requirements for programming? I'd be happy to search for current models that fit your budget and specifications.</code></pre>
</div>
</div>
<p>Notice how the Agent remembers: ‚Ä¢ Your gaming preferences (low latency headphones) ‚Ä¢ Your laptop preferences (ThinkPad, 16GB RAM, Linux compatibility) ‚Ä¢ Your budget constraints ($1200 for laptops) ‚Ä¢ Previous technical issues (MacBook overheating)</p>
<p>This is the power of AgentCore Memory - persistent, personalized customer experiences!</p>
</section>
<section id="congratulations" class="level2">
<h2 class="anchored" data-anchor-id="congratulations">Congratulations! üéâ</h2>
<p>You have successfully completed <strong>Lab 2: Add memory to the Customer Support Agent</strong>!</p>
<section id="what-you-accomplished" class="level3">
<h3 class="anchored" data-anchor-id="what-you-accomplished">What You Accomplished:</h3>
<ul>
<li>Created a serverless managed memory with Amazon Bedrock AgentCore Memory</li>
<li>Implemented long-term memory to store User-Preferences and Semantic (Factual) information.</li>
<li>Integrated AgentCore Memory with the customer support Agent using the hook mechanism provided by Strands Agents</li>
</ul>
<section id="next-up-lab-3---scaling-with-gateway-and-identity" class="level5">
<h5 class="anchored" data-anchor-id="next-up-lab-3---scaling-with-gateway-and-identity">Next Up <a href="../../code_files/aws_agentcore/lab-03-agentcore-gateway.html">Lab 3 - Scaling with Gateway and Identity ‚Üí</a></h5>
</section>
</section>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://docs.aws.amazon.com/bedrock-agentcore/latest/devguide/memory.html">Amazon Bedrock Agent Core Memory</a></li>
<li><a href="https://aws.amazon.com/blogs/machine-learning/amazon-bedrock-agentcore-memory-building-context-aware-agents/">Amazon Bedrock AgentCore Memory Deep Dive blog</a></li>
<li><a href="https://strandsagents.com/latest/documentation/docs/user-guide/concepts/agents/hooks/?h=hooks">Strands Agents Hooks Documentation</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/aarushi-nema\.github\.io\/portfolio-website\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>A hub for showcasing my portfolio, AI and tech blogs, creative drawings, and podcast episodes. All opinions are my own.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
 ¬© 2025 Aarushi Nema
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/aarushi-nema">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/aarushi-nema-64a006185/">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>